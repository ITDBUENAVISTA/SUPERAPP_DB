SET TIME ZONE 'America/Bogota';

-- Creación de la tabla TBL_PERSONAS
CREATE TABLE TBL_PERSONAS (
    PER_ID VARCHAR(100) NOT NULL,
    PER_NOMBRE VARCHAR(200) NOT NULL,
    PER_TELEFONO VARCHAR(100),
    PER_EMAIL VARCHAR(100),
    PER_CREAR_COTIZACION BOOLEAN NOT NULL DEFAULT FALSE,
    PER_USUARIO_CREACION VARCHAR(100) NOT NULL,
    PER_FECHA_CREACION TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT PK_PERSONAS PRIMARY KEY (PER_ID)
);

-- Creación de la tabla TBL_USUARIOS
CREATE TABLE TBL_USUARIOS (
    USU_ID VARCHAR(100) NOT NULL,
    USU_USERNAME VARCHAR(25) NOT NULL,
    USU_CONTRASENA VARCHAR(100) NOT NULL,
    USU_ROLES VARCHAR(500) NOT NULL,
    USU_ESTADO BOOLEAN NOT NULL,
    USU_INTENTOS INTEGER NOT NULL DEFAULT 0,
    USU_PERSONA_ID VARCHAR(100) NOT NULL,
    USU_USUARIO_CREACION VARCHAR(100) NOT NULL,
    USU_FECHA_CREACION TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT PK_USUARIOS PRIMARY KEY (USU_ID),
    CONSTRAINT FK_PERSONA_ID FOREIGN KEY (USU_PERSONA_ID) REFERENCES TBL_PERSONAS(PER_ID),
    CONSTRAINT UQ_TBL_USUARIOS_USU_USERNAME UNIQUE (USU_USERNAME),
    CONSTRAINT UQ_TBL_USUARIOS_USU_PERSONA_ID UNIQUE (USU_PERSONA_ID)
);

CREATE TABLE TBL_VENDEDORES (
    VEN_ID VARCHAR(100) NOT NULL,
    VEN_REGION VARCHAR(100) NOT NULL,
    VEN_ESTADO BOOLEAN NOT NULL DEFAULT TRUE,
    VEN_PERSONA_ID VARCHAR(100) NOT NULL,
    VEN_USUARIO_CREACION VARCHAR(100) NOT NULL,
    VEN_FECHA_CREACION TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT PK_VENDEDORES PRIMARY KEY (VEN_ID),
    CONSTRAINT FK_TBL_VENDEDORES_VEN_PERSONA_ID FOREIGN KEY (VEN_PERSONA_ID) REFERENCES TBL_PERSONAS(PER_ID),
    CONSTRAINT UQ_TBL_VENDEDORES_VEN_PERSONA_ID UNIQUE (VEN_PERSONA_ID)
);

CREATE TABLE TBL_LOTES (
    LOTE_ID VARCHAR(100) NOT NULL,
    LOTE_LOTE VARCHAR(100) NOT NULL,
    LOTE_ESTADO BOOLEAN NOT NULL DEFAULT TRUE,
    LOTE_AREA_VARAS NUMERIC(10, 2),
    LOTE_FRENTE_METROS NUMERIC(10, 2),
    LOTE_FONDO_METROS NUMERIC(10, 2),
    LOTE_AREA_METROS NUMERIC(10, 2),
    LOTE_PRECIO_CONTADO DECIMAL,
    LOTE_PORCENTAJE_DESCUENTO DECIMAL,
    LOTE_DESCUENTO DECIMAL,
    LOTE_PRECIO_FINAL DECIMAL,
    LOTE_VALOR_VARA DECIMAL,
    LOTE_PRIMA DECIMAL,
    LOTE_USUARIO_CREACION VARCHAR(100) NOT NULL,
    LOTE_FECHA_CREACION TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT PK_LOTES PRIMARY KEY (LOTE_ID),
    CONSTRAINT UQ_TBL_LOTES_LOTE_LOTE UNIQUE (LOTE_LOTE)
);

CREATE TABLE TBL_COTIZACIONES (
    COTI_ID VARCHAR(100) NOT NULL,
    COTI_FECHA DATE NOT NULL,
    COTI_VALOR_VARA DECIMAL,
    COTI_PRIMA DECIMAL,
    COTI_PERSONA_ID VARCHAR(100) NOT NULL,
    COTI_VENDEDOR_ID VARCHAR(100) NOT NULL,
    COTI_LOTE_ID VARCHAR(100) NOT NULL,
    COTI_CUOTA_15_ANOS DECIMAL,
    COTI_CUOTA_10_ANOS DECIMAL,
    COTI_CUOTA_5_ANOS DECIMAL,
    COTI_USUARIO_CREACION VARCHAR(100) NOT NULL,
    COTI_FECHA_CREACION TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT PK_COTI_ID PRIMARY KEY (COTI_ID),
    CONSTRAINT FK_TBL_COTIZACIONES_PERSONA_ID FOREIGN KEY (COTI_PERSONA_ID) REFERENCES TBL_PERSONAS(PER_ID),
    CONSTRAINT FK_TBL_COTIZACIONES_COTI_LOTE_ID FOREIGN KEY (COTI_LOTE_ID) REFERENCES TBL_LOTES(LOTE_ID),
    CONSTRAINT FK_TBL_COTIZACIONES_COTI_VENDEDOR_ID FOREIGN KEY (COTI_VENDEDOR_ID) REFERENCES TBL_VENDEDORES(VEN_ID)
);

CREATE TYPE ESTADOS_CLIENTE AS ENUM ('Rescindido', 'Activo', 'Pago Completo', 'Inicio');
CREATE TYPE GENEROS AS ENUM ('Masculino', 'Femenino', 'Otro');
CREATE TYPE ESTADOS_CIVILES AS ENUM ('Soltero/a', 'Casado/a', 'Divorciado/a', 'Viudo/a');
CREATE TYPE TIPOS_CLIENTES AS ENUM ('Normal', 'Mancomunado');

CREATE TABLE TBL_CLIENTES (
    CLI_ID VARCHAR(100),
    CLI_ESTADO ESTADOS_CLIENTE,
    CLI_FICHA_CLIENTE VARCHAR(200),
    CLI_COPIA_IDENTIDAD VARCHAR(200),
    CLI_CONTRATO_INTENCION VARCHAR(1000),
    CLI_PLAN_PAGO VARCHAR(200),
    CLI_RECIBO_RESERVA VARCHAR(200),
    CLI_COTIZACION VARCHAR(200),
    CLI_CONTRATO_PRIVADO VARCHAR(200),
    CLI_FECHA_INICIAL_PAGO DATE ,
    CLI_DESCUENTO_FINAL NUMERIC NOT NULL,
    CLI_PRIMA_FINAL NUMERIC ,
    CLI_MONTO_FINANCIAR NUMERIC ,
    CLI_NUMERO_CUOTAS INTEGER NOT NULL,
    CLI_VALOR_CUOTA NUMERIC NOT NULL,
    CLI_CODIGO_CLIENTE_BANCO VARCHAR(100),
    CLI_DIAS_INICIO NUMERIC,
    CLI_PORCENTAJE_RESCINDIDO NUMERIC,
    CLI_VALOR_RESCINDIDO NUMERIC,
    CLI_ULTIMA_FECHA_PAGO DATE,
    CLI_DIAS_ULTIMO_PAGO NUMERIC,
    CLI_CUOTAS_ATRASADAS NUMERIC,
    CLI_PROXIMA_FECHA_PAGO DATE,
    CLI_EN_MORA NUMERIC,
    CLI_TOTAL_PRIMA_PAGADA NUMERIC,
    CLI_NUMERO_CUOTAS_PAGADAS INTEGER,
    CLI_CUOTAS_ABONADAS INTEGER ,
    CLI_TOTAL_CUOTAS_PAGADAS INTEGER ,
    CLI_TOTAL_PAGADO_DEUDA NUMERIC ,
    CLI_SALDO_CAPITAL NUMERIC,
    CLI_REPORTE_CLIENTE_RESUMIDO VARCHAR(200),
    CLI_FECHA_REPORTE_CLIENTE_RESUMIDO DATE,
    CLI_REPORTE_ESTADO_CUENTA VARCHAR(200),
    CLI_FECHA_REPORTE_ESTADO_CUENTA DATE,
    CLI_MONTO VARCHAR(100),
    CLI_TELEFONO_2 VARCHAR(50),
    CLI_CORREO_2 VARCHAR(100) ,
    CLI_EDAD NUMERIC NOT NULL,
    CLI_SEXO GENEROS,
    CLI_DEPARTAMENTO VARCHAR(100),
    CLI_MUNICIPIO VARCHAR(100),
    CLI_OCUPACION VARCHAR(200),
    CLI_ESTADO_CIVIL ESTADOS_CIVILES,
    CLI_FECHA_RESERVA DATE NOT NULL,
    CLI_COMISION_VENDEDOR NUMERIC,
    CLI_COMISION_TU_INMUEBLE NUMERIC,
    CLI_COMISION_JEFE_VENTAS NUMERIC,
    CLI_TOTAL_PAGADO NUMERIC,
    CLI_FALTA_PAGAR_VENDEDOR NUMERIC,
    CLI_FALTA_PAGAR_TU_INMUEBLE NUMERIC,
    CLI_FALTA_PAGAR_JEFE_VENTAS NUMERIC,
    CLI_PRIMA_PAGADA NUMERIC,
    CLI_DIAS_DESDE_RESERVA INTEGER,
    CLI_RECOMENDAR_RESCINDIR VARCHAR(15),
    CLI_PAGADO_VENDEDOR NUMERIC ,
    CLI_PAGADO_TU_INMUEBLE NUMERIC ,
    CLI_PAGADO_JEFE_VENTAS NUMERIC ,
    CLI_FECHA_RESCINDIDO DATE,
    CLI_MOTIVO_RESCINDIR VARCHAR(1000),
    CLI_COMISION_ANDREA NUMERIC ,
    CLI_PAGADO_ANDREA NUMERIC ,
    CLI_VALOR_TOTAL_CUOTAS NUMERIC ,
    CLI_COBRADOR NUMERIC,
    CLI_70_PORC_SALDO_CAPITAL NUMERIC,
    CLI_DINERO_DEVUELTO_RESCINDIDO NUMERIC,
    CLI_MONTO_RESERVA NUMERIC,
    CLI_CAPITAL_PAGADO_CUOTAS NUMERIC,
    CLI_TOTAL_MORA NUMERIC,
    CLI_TOTAL_CUOTAS_PENDIENTES NUMERIC,
    CLI_TOTAL_SALDO_PENDIENTE NUMERIC,
    CLI_ESTADO_RESCINDIDO VARCHAR(100),
    CLI_INGRESOS_MENSUALES NUMERIC,
    CLI_REFERENCIA_PERSONA_1 VARCHAR(200),
    CLI_CELULAR_REFERENCIA_PERSONA_1 VARCHAR(50),
    CLI_REFERENCIA_PERSONA_2 VARCHAR(200),
    CLI_CELULAR_REFERENCIA_PERSONA_2 VARCHAR(50),
    CLI_OBSERVACIONES VARCHAR(1000),
    CLI_TARJETA_IDENTIDAD VARCHAR(100),
    CLI_RESPONSABLE_FALLECIMIENTO VARCHAR(200),
    CLI_TARJETA_IDENTIDAD_RESPONSABLE VARCHAR(100),
    CLI_NOMBRE_SEGUNDA_PERSONA VARCHAR(200),
    CLI_ESTADO_CIVIL_SEGUNDA_PERSONA ESTADOS_CIVILES,
    CLI_TARJETA_IDENTIDAD_SEGUNDA_PERSONA VARCHAR(100),
    CLI_DIRECCION_SEGUNDA_PERSONA VARCHAR(200),
    CLI_TIPO_CLIENTE TIPOS_CLIENTES NOT NULL,
    CLI_EDAD_SEGUNDA_PERSONA INTEGER,
    CLI_CELULAR_SEGUNDA_PERSONA VARCHAR(50),
    CLI_CORREO_SEGUNDA_PERSONA VARCHAR(100),
    CLI_INGRESOS_SEGUNDA_PERSONA NUMERIC,
    CLI_OCUPACION_SEGUNDA_PERSONA VARCHAR(200),
    CLI_DIRECCION VARCHAR(200),
    CLI_RESTANTE_PRIMA NUMERIC,
    CLI_RESIDE_FUERA_HONDURAS BOOLEAN NOT NULL,
    CLI_CARTA_INTENCION VARCHAR(200),
    CLI_SALDO_CAPITAL_NUEVO NUMERIC,
    CLI_FECHA_ACTIVO DATE,
    CLI_FECHA_ESCRITURACION DATE,
    CLI_FINIQUITO_DEVOLUCION BOOLEAN,
    CLI_ESTADO_FIRMA VARCHAR(100),
    CLI_AUDITOR_INTERNO VARCHAR(100),
    CLI_FECHA_REVISION_AUDITOR_INTERNO DATE,
    CLI_OBSERVACIONES_AUDITOR_INTERNO VARCHAR(1000),
    CLI_ACUERDOS_ESPECIALES VARCHAR(1000),
    CLI_PAGADO_GERENCIA NUMERIC,
    CLI_COMISION_GERENCIA NUMERIC,
    CLI_CONTRATO_REPRESENTANTE BOOLEAN,
    CLI_NOMBRE_REPRESENTANTE VARCHAR(200),
    CLI_TELEFONO_REPRESENTANTE VARCHAR(50),
    CLI_DESCRIPCION_PROBLEMA_FIRMA VARCHAR(1000),
    CLI_USUARIO_CREACION VARCHAR(100) NOT NULL,
    CLI_FECHA_CREACION TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CLI_PERSONA_ID VARCHAR(100) NOT NULL,
    CLI_COTIZACION_ID VARCHAR(100) NOT NULL,
    CLI_VENDEDOR_ID VARCHAR(100) NOT NULL,
    CONSTRAINT PK_CLI_ID PRIMARY KEY (CLI_ID),
    CONSTRAINT FK_TBL_CLIENTES_PERSONA_ID FOREIGN KEY (CLI_PERSONA_ID) REFERENCES TBL_PERSONAS(PER_ID),
    CONSTRAINT FK_TBL_CLIENTES_COTIZACION_ID FOREIGN KEY (CLI_COTIZACION_ID) REFERENCES TBL_COTIZACIONES(COTI_ID),
    CONSTRAINT FK_TBL_CLIENTES_VENDEDOR_ID FOREIGN KEY (CLI_VENDEDOR_ID) REFERENCES TBL_VENDEDORES(VEN_ID)
);

CREATE TABLE TBL_PLAN_PAGOS (
    PLAN_ID INTEGER,
    PLAN_NUMERO_CUOTA INTEGER,
    PLAN_SALDO_CAPITAL NUMERIC,
    PLAN_PAGO_CAPITAL NUMERIC,
    PLAN_PAGO_INTERESES NUMERIC,
    PLAN_CUOTA_TOTAL NUMERIC,
    PLAN_CLIENTE_ID VARCHAR(100) NOT NULL,
    CONSTRAINT PK_PLAN_ID PRIMARY KEY (PLAN_ID),
    CONSTRAINT FK_TBL_PLAN_PAGOS_CLIENTE_ID FOREIGN KEY (PLAN_CLIENTE_ID) REFERENCES TBL_CLIENTES(CLI_ID)
);

CREATE TABLE TBL_BANCOS (
    BAN_ID SERIAL,
    BAN_NOMBRE VARCHAR(100) NOT NULL,
    BAN_NUMERO_CUENTA VARCHAR(100) NOT NULL,
    BAN_MONEDA VARCHAR(100) NOT NULL,
    BAN_USUARIO_CREACION VARCHAR(100) NOT NULL,
    BAN_FECHA_CREACION TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT PK_BAN_ID PRIMARY KEY (BAN_ID),
    CONSTRAINT UQ_TBL_BANCOS_BAN_NUMERO_CUENTA UNIQUE (BAN_NUMERO_CUENTA)
)

CREATE TABLE TBL_PAGOS (
    PAGO_ID VARCHAR(100),
    PAGO_FECHA DATE NOT NULL,
    PAGO_FECHA_MES_CORRESPONDENCIA DATE,
    PAGO_CONCEPTO VARCHAR(255),
    PAGO_VALOR NUMERIC,
    PAGO_VALOR_CUOTA NUMERIC,
    PAGO_FECHA_ULTIMA_CUOTA DATE,
    PAGO_DIAS_ULTIMO_PAGO INTEGER,
    PAGO_DIAS_ULTIMO_PAGO_PENDIENTE INTEGER,
    PAGO_CUOTAS_ATRASADAS INTEGER,
    PAGO_ULTIMO_PAGO_PENDIENTE DATE,
    PAGO_RECARGO_MORA NUMERIC,
    PAGO_A_MORA NUMERIC,
    PAGO_SALDO_MORA NUMERIC,
    PAGO_COMPROBANTE VARCHAR(255),
    PAGO_FOTO_COMPROBANTE BYTEA,
    PAGO_BANCO VARCHAR(100),
    PAGO_INGRESO_TOTAL NUMERIC,
    PAGO_FECHA_CAMBIO DATE,
    PAGO_USD NUMERIC,
    PAGO_DESCRIPCION TEXT,
    PAGO_VALOR_DOLAR NUMERIC,
    PAGO_AUDITADO BOOLEAN DEFAULT FALSE,
    PAGO_PERSONA_INGRESA VARCHAR(255),
    PAGO_PARCIAL VARCHAR(100),
    PAGO_MONTO NUMERIC,
    PAGO_FECHA_AUDITORIA DATE,
    PAGO_AUDITOR VARCHAR(255),
    PAGO_SALDO_CAPITAL_ANTERIOR NUMERIC,
    PAGO_A_CAPITAL NUMERIC,
    PAGO_A_INTERESES NUMERIC,
    PAGO_SALDO_CAPITAL NUMERIC,
    PAGO_PENDIENTE_INTERES NUMERIC,
    PAGO_PENDIENTE_CAPITAL NUMERIC,
    PAGO_RECIBO_DEVOLUCION VARCHAR(255),
    PAGO_CUOTAS_PAGADAS INTEGER,
    PAGO_CUOTAS_ATRAS INTEGER,
    PAGO_REFERENCIA_ESTADO_CUENTA VARCHAR(255),
    PAGO_RESCINDIDO_DIRIGIDO_A VARCHAR(255),
    PAGO_USUARIO_CREACION VARCHAR(100) NOT NULL,
    PAGO_FECHA_CREACION TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PAGO_CLIENTE_ID VARCHAR(100) NOT NULL,
    CONSTRAINT PK_PAGO_ID PRIMARY KEY (PAGO_ID),
    CONSTRAINT FK_TBL_PAGOS_CLIENTE_ID FOREIGN KEY (PAGO_CLIENTE_ID) REFERENCES TBL_CLIENTES(CLI_ID)
);

CREATE TABLE TBL_COMISIONES (
    COMI_ID VARCHAR(100),
    COMI_FECHA_PAGO DATE,
    COMI_TOTAL_A_PAGAR NUMERIC,
    COMI_ESTADO BOOLEAN DEFAULT FALSE,
    COMI_VENDEDOR_ID VARCHAR(100) NOT NULL,
    COMI_USUARIO_CREACION VARCHAR(100) NOT NULL,
    COMI_FECHA_CREACION TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT PK_COMI_ID PRIMARY KEY (COMI_ID),
    CONSTRAINT FK_TBL_COMISIONES_VENDEDOR_ID FOREIGN KEY (COMI_VENDEDOR_ID) REFERENCES TBL_VENDEDORES(VEN_ID)
);

CREATE TABLE TBL_COMISIONES_DETALLE (
    COMI_DET_ID VARCHAR(100),
    COMI_DET_FECHA DATE,
    COMI_DET_A_QUIEN_SE_PAGA VARCHAR(100),
    COMI_DET_TIPO_PAGO VARCHAR(100),
    COMI_DET_VALOR NUMERIC,
    COMI_DET_OBSERVACIONES VARCHAR(1000),
    COMI_DET_CLIENTE_ID VARCHAR(100),
    COMI_DET_COMISION_ID VARCHAR(100) NOT NULL,
    COMI_DET_USUARIO_CREACION VARCHAR(100) NOT NULL,
    COMI_DET_FECHA_CREACION TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT PK_COMI_DET_ID PRIMARY KEY (COMI_DET_ID),
    CONSTRAINT FK_TBL_COMISIONES_DETALLE_CLIENTE_ID FOREIGN KEY (COMI_DET_CLIENTE_ID) REFERENCES TBL_CLIENTES(CLI_ID),
    CONSTRAINT FK_TBL_COMISIONES_DETALLE_COMISION_ID FOREIGN KEY (COMI_DET_COMISION_ID) REFERENCES TBL_COMISIONES(COMI_ID)
);

CREATE TABLE TBL_CONTRATOS (
    CON_ID VARCHAR(100),
    CON_AREA_LETRAS VARCHAR(100),
    CON_PRECIO_PACTADO_LETRAS VARCHAR(100),
    CON_VALOR_FINANCIAR_LETRAS VARCHAR(100),
    CON_NUMERO_CUOTAS_LETRAS VARCHAR(100),
    CON_VALOR_CUOTA_LETRAS VARCHAR(100),
    CON_CLIENTE_ID VARCHAR(100) NOT NULL,
    CON_USUARIO_CREACION VARCHAR(100) NOT NULL,
    CON_FECHA_CREACION TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT PK_CON_ID PRIMARY KEY (CON_ID),
    CONSTRAINT FK_TBL_CONTRATOS_CLIENTE_ID FOREIGN KEY (CON_CLIENTE_ID) REFERENCES TBL_CLIENTES(CLI_ID)
)